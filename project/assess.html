<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
        crossorigin="anonymous">
    <title>Adepto</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <style>
        .lead {
            font-size: 6em;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="container-fluid h-25">
            <h4 class="text-center">{{title}}</h4>
            <div class="row ">
                <div class="col-6">{{assessmentSet}}</div>
                <div class="col-6 text-right">{{learner}}</div>
            </div>
        </div>

        <div class="container-fluid h-50">
            <div class="row align-items-center h-100">
                <div class="col-12 mx-auto">
                    <p class="lead text-center">{{currentItem.item}}</p>
                </div>
            </div>
        </div>

        <div class="container-fluid h-25 ">
            <div class="h-50 ">
                <!-- empty placeholder to push down footer items -->
            </div>
            <div class="h-50 ">

                <div class=" h-50">
                    <div class="text-center d-block d-xl-none">
                        <!-- <div class="col text-right d-block d-xl-none"> -->
                        <button type="button" class="btn btn-danger " v-on:click="incorrectAnswer">Incorrect</button>
                        <!-- </div>   -->
                        <!-- <div class="col d-block d-xl-none"> -->
                        <button type="button" class="btn btn-success" v-on:click="correctAnswer">Correct</button>
                        <!-- </div> -->
                    </div>
                </div>
                <div class="h-50">
                    <div class="row ">

                        <!-- <div class="col-4">{{bottomLeft}}</div> -->

                        <div class="col-6">
                            <a class="btn btn-secondary btn-sm" href="./dashboard.html" role="button">End Assessment</a>
                            <!-- <small><a href="./dashboard.html">End Assessment</a></small> -->
                        </div>

                        <div class="col-6 text-right">{{bottomRight}} {{seconds}}</div>


                    </div>
                    <div class="progress mt-2">
                        <div class="progress-bar" role="progressbar" :style="'width: ' + itemsRemainingPercentage + '%'"
                            :aria-valuenow="itemsRemainingPercentage" aria-valuemin="0" aria-valuemax="100">{{itemsRemaining}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- todo interface tutorial and swipe capability -->
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                title: "Adepto - Assessment",
                randomOrder: true,
                desiredAnswerTime: 0,
                autoAdvance: true,
                answerCountFilter: 3,
                itemLimit: 10,
                assessmentSet: 'Multiplicaton Facts',
                learner: 'Sally James',
                // bottomLeft: 'Remaining: 11',
                bottomRight: 'Seconds: ',
                seconds: 0,
                sampleitems: [
                    { id: 10, item_number: 1, item: "a", assessment_set_id: 3 },
                    { id: 11, item_number: 2, item: "about", assessment_set_id: 3 },
                    { id: 12, item_number: 3, item: "all", assessment_set_id: 3 },
                    { id: 13, item_number: 4, item: "an", assessment_set_id: 3 },
                    { id: 14, item_number: 5, item: "and", assessment_set_id: 3 },
                    { id: 15, item_number: 6, item: "are", assessment_set_id: 3 },
                    { id: 16, item_number: 7, item: "What is the capital of spain", assessment_set_id: 1 },
                ],
                items: [],
                currentItemIndex: 0,
                sampledesiredAnswerTime: 0,
                currentItem: { item: '' }
            },
            computed: {
                itemsRemaining: function () {
                    return this.items.length - 1 - this.currentItemIndex
                    // return this.currentItemIndex / (this.items.length-1) * 100
                },
                itemsRemainingPercentage: function () {
                    // return 100
                    return Math.round((this.currentItemIndex + 1) / this.items.length * 100)
                }
            },
            methods: {
                correctAnswer: function (event) {
                    console.log("correct answer for " + this.items[this.currentItemIndex].item);
                    clearTimeout(this.timeout)
                    this.nextItem()
                },
                incorrectAnswer: function (event) {
                    console.log("incorrect answer for " + this.items[this.currentItemIndex].item);
                    this.nextItem()
                },
                beginAssessment: function () {
                    this.currentItem = this.items[0]
                    this.startTimer()
                },
                endAssessment: function () {
                    clearInterval(this.interval)
                    alert("TODO end of assessment")
                    
                },
                endTimer: function () {
                    console.log("timer ended");
                    clearTimeout(this.timeout)
                    if (this.desiredAnswerTime != 0) {
                        this.incorrectAnswer()
                        // this.nextItem()
                        // this.currentItem = this.items[this.currentItemIndex]
                    }
                },
                startTimer: function () {
                    console.log("timer started");
                    if (this.desiredAnswerTime !== 0) {
                        this.seconds = this.desiredAnswerTime
                    }

                    this.timeout = setTimeout(this.endTimer, this.desiredAnswerTime * 1000)
                },
                updateTimer: function () {
                    this.seconds -= 1;
                },
                nextItem: function () {
                    if (this.currentItemIndex < (this.items.length -1)) {
                        this.currentItemIndex += 1
                        this.currentItem = this.items[this.currentItemIndex]
                        this.startTimer()
                    }else {
                        this.endAssessment()
                    }
                }

            },
            created: function () {
                this.items = this.sampleitems;
                this.desiredAnswerTime = this.sampledesiredAnswerTime;
                this.interval = setInterval(this.updateTimer, 1000);
                this.beginAssessment();

            }
        });

    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>


</body>

</html>